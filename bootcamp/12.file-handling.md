# File Handling
File handling in C allows programs to **store** and **retrieve** data from files on disk by providing a powerful set of file I/O functions for working with both **text** and **binary** files.

### Types of Files
- **Text Files**: Store data as readable characters.(e.g.,`.txt`, `.csv`).
- **Binary Files**:  Store data in binary format, which is not directly human-readable (e.g., `.dat`, `.bin`).

**Examples:**
- text_file.txt
```
Hi, I'm a text file 
```
- binary_file.bin
``` 
01001000 01101001 00101100 00100000
01001001 00100111 01101101 00100000 
01100001 00100000 01100010 01101001 
01101110 01100001 01110010 01111001 
00100000 01100110 01101001 01101100 
01100101 00100000
```

### Common file operations
- Creating/opening a file
- Reading from a file
- Writing to a file
- Moving the file pointer
- Closing a file

### The FILE * Pointer
To perform file operations, you must declare a pointer of type `FILE *`. This pointer will be used to refer to the file throughout your program.

**Example:**
```c
#include <stdio.h>

int main() {
    FILE *fp;

    return 0;
}

```
> `FILE` is a structure defined in `stdio.h` that holds information about the file (such as its current position and buffer).

### Opening a File
The file must be opened to perform any operation. The `fopen()` function is used to create a new file or open an existing file, requiring both the file name and the mode.

**Example:**
```c
#include <stdio.h>

int main() {
    FILE *fp;
    
    fp = fopen("example.txt", "w");
    if (fp == NULL) {
        printf("Unable to open file for writing.\n");
        return 1;
    }
    return 0;
}
```
If the file is opened successfully, it returns a **file pointer** to it. Otherwise, it returns **NULL**.

#### File Opening Modes
Text File Modes
| Mode   | Description                                                       |
|:--------:|-----------------------------------------------------------------|
| "r"    | Open for reading (file must exist)                                |
| "w"    | Open for writing (creates new file or overwrites existing file)   |
| "a"    | Open for appending (data added to end; file created if not exists)|
| "r+"   | Open for both reading and writing (file must exist)               |
| "w+"   | Open for reading and writing (overwrites existing or creates new) |
| "a+"   | Open for reading and appending (create if not exists)             |

Binary File Modes

| Mode   | Description                                                        |
|:--------:|------------------------------------------------------------------|
| "rb"   | Open binary file for reading (must exist)                          |
| "wb"   | Open binary file for writing (creates new or overwrites existing)  |
| "ab"   | Open binary file for appending (create if not exists, write at end)|
| "rb+"  | Open binary file for reading and writing (must exist)              |
| "wb+"  | Open binary file for reading and writing (overwrites/creates)      |
| "ab+"  | Open binary file for reading and appending (create if not exists)  |


### Write to a File
C provides several functions to write data to files.
| Function   | Description                                            | Purpose of Each Parameter| 
|------------|--------------------------------------------------------|---------------------------|
| `fprintf(FILE *stream, const char *format, ...)`| Like `printf()`, but writes formatted output to a file | stream: File pointer<br>format: Format string (like printf)<br>...: Variables/values to write|
| `fputs(const char *str, FILE *stream)`  | Writes a string to a file   |str: Null-terminated string to write<br>stream: File pointer|
| `fputc(int char, FILE *stream)`  | Writes a single character to a file|char: Character to write (as int)<br>stream: File pointer   |
| `fputw(int value, FILE *stream)`  | Writes an integer (as binary) to a file|value: Integer to write<br>stream: File pointer        |
| `fwrite(const void *ptr, size_t size, size_t count, FILE *stream)` | Writes a block of data to a binary file|ptr: Pointer to data buffer/array<br>size: Size of each element (in bytes)<br>count: Number of elements<br>stream: File pointer|

**Examples:**
- Write to a Text File
```c
#include <stdio.h>

int main() {
    FILE *fp;
    
    fp = fopen("example.txt", "w");
    if (fp == NULL) {
        printf("Unable to open file for writing.\n");
        return 1;
    }
    fprintf(fp, "Hello, world!\n");  // Formatted text
    fputs("C programming\n", fp);  // String
    fputc('A', fp);  // Single character

    return 0;
}
```
- Write to a Binary File
```c
#include <stdio.h>

int main() {
    FILE *fp;
    int num = 100;

    fp = fopen("example.bin", "wb");
    if (fp == NULL) {
        printf("Unable to open binary file for writing.\n");
        return 1;
    }
    fwrite(&num, sizeof(int), 1, fp);

    return 0;
}
```


### Reading From a File
Reading can be done using these functions.
| Function   | Description                                            | Purpose of Each Parameter| 
|------------|--------------------------------------------------------|---------------------------|
| `fscanf(FILE *stream, const char *format, ...)` | Reads formatted input from a file (similar to `scanf()`)|stream: File pointer<br>format: Format string (like scanf)<br>...: Pointers to variables for input |
| `fgets(char *str, int n, FILE *stream)`  | Reads a line (string) from a file  | str: Buffer to store string read<br>n: Maximum number of characters (including null terminator)<br>stream: File pointer|
| `fgetc(FILE *stream)`  | Reads a single character from a file|stream: File pointer|
| `fgetw(FILE *stream)`  | Reads an integer (as binary) from a file |stream: File pointer|
| `fread(void *ptr, size_t size, size_t count, FILE *stream)`  | Reads a block of data from a binary file |ptr: Pointer to buffer for storing read data<br>size: Size of each element to read<br>count: Number of elements to read<br>stream: File pointer|

**Examples:**
- Read from a Text File 
```c
#include <stdio.h>

int main() {
    FILE *fp;
    int num;
    char buffer[100];
    char ch;

    fp = fopen("example.txt", "r");
    if (fp == NULL) {
        printf("Unable to open file for reading.\n");
        return 1;
    }

    fscanf(fp, "%d", &num);  // Formatted input
    fgets(buffer, sizeof(buffer), fp);  // String input
    ch = fgetc(fp);  // Single character

    printf("fscanf: %d\n", num);
    printf("fgets: %s", buffer);
    printf("fgetc: %c\n", ch);

    return 0;
}
```
- Read from a Binary File 
```c
#include <stdio.h>

int main() {
    FILE *fp;
    int num = 0;

    fp = fopen("example.bin", "rb");
    if (fp == NULL) {
        printf("Unable to open binary file for reading.\n");
        return 1;
    }
    fread(&num, sizeof(int), 1, fp);

    printf("Integer read from binary file: %d\n", num);
    return 0;
}
```
### Move File Pointer
The file pointer tracks your current position in a file,  but you can manually set the file pointer using the `fseek()` function.
```c
fseek(FILE *stream, long int offset, int whence);
```
- **stream**: file pointer
- **offset**: number of bytes to move
- **whence**: starting position (see table below)

#### Different whence in fseek()
| Whence      | Meaning                                       |
|-------------|-----------------------------------------------|
| SEEK_SET    | Start from the beginning of the file          |
| SEEK_CUR    | Start from the current position               |
| SEEK_END    | Start from the end of the file                |

**Example:**  
```c
#include <stdio.h>

int main() {
    FILE *fp;
    char buffer[100];

    fp = fopen("example.txt", "r");
    if (fp == NULL) {
        printf("Unable to open file.\n");
        return 1;
    }

    fseek(fp, 0, SEEK_SET); // Move to beginning

    while (fgets(buffer, sizeof(buffer), fp) != NULL) {
        printf("%s", buffer);
    }

    return 0;
}
```

### Closing a File

After all operations, close the file using `fclose()` to free up resources.

**Example:**
```c
#include <stdio.h>

int main() {
    FILE *fp;
    
    fp = fopen("example.txt", "w");
    if (fp == NULL) {
        printf("Unable to open file for writing.\n");
        return 1;
    }
    fprintf(fp, "Hello, world!\n");

    fclose(fp); // Close the file

    printf("Data written to example.txt\n");
    return 0;
}
```

## Example
-  Writes multiple lines to a text file, then reads and displays the content.
```c
#include <stdio.h>

int main() {
    FILE *fp;
    char str[50];

    // Write to a text file
    fp = fopen("sample.txt", "w");
    if (fp == NULL) {
        printf("Unable to open file for writing.\n");
        return 1;
    }
    fprintf(fp, "Hello, C Programming!\n");
    fputs("This is a sample text file.\n", fp);
    fclose(fp);

    // Read from the text file
    fp = fopen("sample.txt", "r");
    if (fp == NULL) {
        printf("Unable to open file for reading.\n");
        return 1;
    }
    printf("Contents of sample.txt:\n");
    while (fgets(str, sizeof(str), fp) != NULL) {
        printf("%s", str);
    }
    fclose(fp);

    return 0;
}
```
- Write an array of integers to a binary file and read the numbers back into another array. 
```c
#include <stdio.h>

int main() {
    FILE *fp;
    int numbers[5] = {10, 20, 30, 40, 50};
    int read_numbers[5];

    // Write to a binary file
    fp = fopen("data.bin", "wb");
    if (fp == NULL) {
        printf("Unable to open binary file for writing.\n");
        return 1;
    }
    fwrite(numbers, sizeof(int), 5, fp);
    fclose(fp);

    // Read from the binary file
    fp = fopen("data.bin", "rb");
    if (fp == NULL) {
        printf("Unable to open binary file for reading.\n");
        return 1;
    }
    fread(read_numbers, sizeof(int), 5, fp);
    fclose(fp);

    printf("Numbers read from binary file:\n");
    for (int i = 0; i < 5; i++) {
        printf("%d ", read_numbers[i]);
    }
    printf("\n");

    return 0;
}
```

## Practice
1. **Counting Words in a Text File**  
   - Open a text file named `story.txt` for writing.
   - Store three lines in the file.
   - Reopen the file for reading, then count and print the number of words in the file.

2. **Sum of Floating-Point Numbers in a Binary File**  
   - Declare an array of ten floating-point numbers.
   - Write the array to a binary file named `floats.bin`.
   - Reopen the file for reading, and read all the float values into another array.
   - Calculate the sum of the floats and print the result.
